# ~/.commonrc — Cross-platform shell configuration
# Sourced by both bash and zsh on any system.
# Machine-specific config (EDITOR, secrets, etc.) goes in ~/.localrc

# ─── PATH ─────────────────────────────────────────────────────────────────────

export PATH="$HOME/.local/bin:$PATH"
export PATH="$PATH:$HOME/.lmstudio/bin"

# ─── Environment ──────────────────────────────────────────────────────────────

[[ -f "$HOME/.env" ]]     && source "$HOME/.env"
[[ -f "$HOME/.localrc" ]] && source "$HOME/.localrc"

# ─── Aliases & Functions ──────────────────────────────────────────────────────

[[ -f "$HOME/.aliases" ]]   && source "$HOME/.aliases"
[[ -f "$HOME/.functions" ]] && source "$HOME/.functions"

# ─── fzf ──────────────────────────────────────────────────────────────────────

export FZF_COMPLETION_TRIGGER='~~'

if command -v fd &>/dev/null; then
    export FZF_DEFAULT_COMMAND='fd --type f --strip-cwd-prefix --hidden --follow --exclude .git'
    export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
fi

# ─── Tool completions (shell-aware) ──────────────────────────────────────────

if [[ -n "$BASH_VERSION" ]]; then
    if command -v kubectl &>/dev/null; then
        source <(kubectl completion bash)
        complete -o default -F __start_kubectl k
    fi
    if command -v skaffold &>/dev/null; then
        source <(skaffold completion bash)
    fi
    if command -v just &>/dev/null && [[ -f "$HOME/.just_completion_bash" ]]; then
        source "$HOME/.just_completion_bash"
    fi
elif [[ -n "$ZSH_VERSION" ]]; then
    if command -v kubectl &>/dev/null; then
        source <(kubectl completion zsh)
    fi
    if command -v skaffold &>/dev/null; then
        source <(skaffold completion zsh)
    fi
    if [[ -d "$HOME/.docker/completions" ]]; then
        fpath=("$HOME/.docker/completions" $fpath)
    fi
fi
